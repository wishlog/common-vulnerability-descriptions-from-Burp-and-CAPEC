#!/usr/bin/env node

fs = require('fs')
var stdin = process.openStdin();

var data = "";

stdin.on('data', function(chunk) {
  data += chunk;
});


stdin.on('end', function() {
//  console.log("DATA:\n" + data + "\nEND DATA");
fs.readFile("./"+data.slice(0,-1), 'utf8', function (err,data) {
  if (err) {
    return console.log(err);
  }


  data = data.replace(/\"/g, "\"\"");
  data = data.replace(/<h1.*\/h1>\n/g, "\",\"");
  data = data.replace(/<!doctype html>\n<html>\n<body>/,"\"");

  //data = data.replace(/\n/g, "<p>&nbsp;</p>");
  data = data.replace(/\n+\"/g, "\"");
  data = data.replace(/\"\n+/g, "\"");

  //data = data.replace(/\n\",\"/g, "\",\"");
  //data = data.replace(/\",\"\n/g, "\",\"");
  //data = data.replace(/\n\n/g, "\n");
  //data = data.replace(/>\n</g, "><");


  data = data.replace(/\n*<\/body>\n*<\/html>\n*.*/g, "\"\n");

fs.appendFile('message.csv', data, function (err) {
  if (err) throw err;
});
});
});
